/*!
* easy-barcode-scanner
* @version 10.2.1000 (build 2024-09-12T10:07:23.677Z)
* A wrapper for https://github.com/Dynamsoft/barcode-reader-javascript. Easier to use.
* The wrapper is under Unlicense, the Dynamsoft SDK it depended is still protected by copyright.
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("dynamsoft-core"),require("dynamsoft-license"),require("dynamsoft-capture-vision-router"),require("dynamsoft-camera-enhancer"),require("dynamsoft-utility")):"function"==typeof define&&define.amd?define(["dynamsoft-core","dynamsoft-license","dynamsoft-capture-vision-router","dynamsoft-camera-enhancer","dynamsoft-utility"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).EasyBarcodeScanner=t(e.Dynamsoft.Core,e.Dynamsoft.License,e.Dynamsoft.CVR,e.Dynamsoft.DCE,e.Dynamsoft.Utility)}(this,(function(e,t,n,a,i){"use strict";if(null!=typeof document){let e=null===document||void 0===document?void 0:document.currentScript;if(e){let n=e.getAttribute("data-license");n&&(t.LicenseManager.license=n)}}class r{constructor(){this.templateName="ReadBarcodes_SpeedFirst",this.isBeepOnUniqueRead=!0}static get license(){return t.LicenseManager.license}static set license(e){t.LicenseManager.license=e}get videoFit(){return this._view.getVideoFit()}set videoFit(e){this._view.setVideoFit(e)}get scanRegionMaskVisible(){return this._view.isScanRegionMaskVisible()}set scanRegionMaskVisible(e){this._view.setScanRegionMaskVisible(e)}get decodedBarcodeVisible(){return this._view._drawingLayerManager.getDrawingLayer(2).isVisible()}set decodedBarcodeVisible(e){this._view._drawingLayerManager.getDrawingLayer(2).setVisible(e)}get minImageCaptureInterval(){return this._cvRouter._minImageCaptureInterval}set minImageCaptureInterval(e){this._cvRouter._minImageCaptureInterval=e}static async createInstance(t){let s=new r;try{let r=s._cvRouter=await n.CaptureVisionRouter.createInstance(),o=s._view=await a.CameraView.createInstance(t),c=s._cameraEnhancer=await a.CameraEnhancer.createInstance(o);r.setInput(c);let d=s._filter=new i.MultiFrameResultCrossFilter;d.enableResultCrossVerification(e.EnumCapturedResultItemType.CRIT_BARCODE,!0),r.addResultFilter(d),r.addResultReceiver({onDecodedBarcodesReceived:e=>{let t=e.barcodeResultItems;try{s.onFrameRead&&s.onFrameRead(t)}catch(e){}let n=!1;for(let e of t)if(!e.duplicate){n=!0;try{s.onUniqueRead&&s.onUniqueRead(e.text,e)}catch(e){}}n&&s.isBeepOnUniqueRead&&a.Feedback.beep()}})}catch(e){throw s.dispose(),e}return s}getUIElement(){return this._view.getUIElement()}setScanRegion(e){this._cameraEnhancer.setScanRegion(e)}getScanRegionMaskStyle(){return this._view.getScanRegionMaskStyle()}setScanRegionMaskStyle(e){this._view.setScanRegionMaskStyle(e)}getDecodedBarcodeStyle(){return a.DrawingStyleManager.getDrawingStyle(3)}setDecodedBarocdeStyle(e){a.DrawingStyleManager.updateDrawingStyle(3,e)}async open(){if(this._cameraEnhancer.isOpen())this._cameraEnhancer.isPaused()&&(await this._cameraEnhancer.resume(),await this._cvRouter.startCapturing(this.templateName));else{let e=this._view.getUIElement();e.parentElement||(Object.assign(e.style,{position:"fixed",left:"0",top:"0",width:"100vw",height:"100vh"}),document.body.append(e),this._bAddToBodyWhenOpen=!0),await this._cameraEnhancer.open(),await this._cvRouter.startCapturing(this.templateName)}}close(){let e=this._view.getUIElement();this._bAddToBodyWhenOpen&&(this._bAddToBodyWhenOpen=!1,document.body.removeChild(e)),this._cvRouter.stopCapturing(),this._cameraEnhancer.close()}pause(){this._cvRouter.stopCapturing(),this._cameraEnhancer.pause()}turnOnTorch(){this._cameraEnhancer.turnOnTorch()}turnOffTorch(){this._cameraEnhancer.turnOffTorch()}convertToPageCoordinates(e){return this._cameraEnhancer.convertToPageCoordinates(e)}convertToClientCoordinates(e){return this._cameraEnhancer.convertToClientCoordinates(e)}dispose(){var e,t;null===(e=this._cvRouter)||void 0===e||e.dispose();let n=this._view.getUIElement();null===(t=this._cameraEnhancer)||void 0===t||t.dispose(),this._bAddToBodyWhenOpen&&(this._bAddToBodyWhenOpen=!1,document.body.removeChild(n))}static async scanBarcode(e="./dce.ui.html"){return await new Promise((async(t,n)=>{let a=await r.createInstance(e),i=new Promise((e=>{let t=0;a.onFrameRead=n=>{n.length&&(++t,2!=t&&"disabled"===a._cameraEnhancer.singleFrameMode||e(n))}})),s=a.getUIElement().shadowRoot,o=s.querySelector(".easyscanner-close-btn");o.addEventListener("click",(()=>{a.dispose(),t(null)})),s.querySelector(".easyscanner-photo-album-btn").addEventListener("click",(async()=>{a.close(),a._cameraEnhancer.singleFrameMode="image",await a.open()}));let c=s.querySelector(".easyscanner-camera-and-resolution-btn");c.addEventListener("pointerdown",(async()=>{"720P"===c.textContent?(a._cameraEnhancer.setResolution({width:1920,height:1080}),c.textContent="1080P"):(a._cameraEnhancer.setResolution({width:1280,height:720}),c.textContent="720P")})),s.querySelector(".easyscanner-flash-btn").addEventListener("pointerdown",(()=>{a.turnOnTorch()})),await a.open();let d=await i;if(1===d.length)return a.dispose(),void t(d[0].text);let l=document.createElement("div");l.className="easyscanner-barcode-result-select-mask",s.append(l);let u=new Promise((e=>{for(let t of d){let n=0,i=0;for(let e=0;e<4;++e){let a=t.location.points[e];n+=a.x,i+=a.y}let r=a.convertToClientCoordinates({x:n/4,y:i/4}),o=document.createElement("div");o.className="easyscanner-barcode-result-option",o.style.left=r.x+"px",o.style.top=r.y+"px",o.addEventListener("click",(()=>{e(t.text)})),s.append(o)}})),m=document.createElement("div");m.className="easyscanner-barcode-result-select-tip",m.textContent="Multiple scans found, please select one.",s.append(m),s.append(o),"disabled"===a._cameraEnhancer.singleFrameMode&&a.pause();let h=await u;a.dispose(),t(h)}))}}return r}));
